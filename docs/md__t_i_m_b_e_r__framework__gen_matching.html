<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIMBER: How to use GenMatching.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIMBER
   &#160;<span id="projectnumber">beta</span>
   </div>
   <div id="projectbrief">Tree Interface for Making Binned Events with RDataFrame</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to use <a class="el" href="_gen_matching_8h_source.html">GenMatching.h</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The NanoAOD format only stores the mother index of each generator particle. This often makes it difficult to traverse the decay tree in search of particles that are relevant to an analysis. <code><a class="el" href="_gen_matching_8h_source.html">GenMatching.h</a></code> houses infrastructure to recreate the relevant parts of the decay chain from the information available.</p>
<p>Note that the classes in <code><a class="el" href="_gen_matching_8h_source.html">GenMatching.h</a></code> are only useful within the context of another .cc script that is extracting information from the decay tree. There are no one-line function calls that are useful within a TIMBER <code>Define</code> or <code>Cut</code>.</p>
<p>Below is an example of how to isolate the three quarks in an all-hadronic top quark decay and return the number of quarks that are merged inside the reconstructed jet (this is something one has to do for applying top tagging scale factors).</p>
<h2>Example: top to b+W(qq)</h2>
<p>First, one should construct the skeleton of the function.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Math/Vector4Dfwd.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TIMBER/Framework/include/GenMatching.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> LVector = ROOT::Math::PtEtaPhiMVector;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> NMerged(LVector top_vect, <span class="keywordtype">int</span> nGenPart,</div><div class="line">                RVec&lt;float&gt; GenPart_pt, RVec&lt;float&gt; GenPart_eta,</div><div class="line">                RVec&lt;float&gt; GenPart_phi, RVec&lt;float&gt; GenPart_mass,</div><div class="line">                RVec&lt;int&gt; GenPart_pdgId, RVec&lt;int&gt; GenPart_status,</div><div class="line">                RVec&lt;int&gt; GenPart_statusFlags, RVec&lt;int&gt; GenPart_genPartIdxMother) {</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> nmerged = 0;</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">        rest of the code here</span></div><div class="line"><span class="comment">    */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> nmerged;</div><div class="line">}</div></div><!-- fragment --><p>Now create a <a class="el" href="class_gen_particle_objs.html" title="Object that stores and manipulates the information for gen particles. Stores all gen particles in the...">GenParticleObjs</a> instance. This is effectively reconfigures the input information from vectors of properties to a vector of <a class="el" href="class_particle.html" title="Stores identifying features of a particle in the GenPart collection. ">Particle</a> objects, each with its own properties. Adding to the <code>rest of the code here</code> area...</p>
<div class="fragment"><div class="line"><a class="code" href="class_gen_particle_objs.html">GenParticleObjs</a> GenParticles (GenPart_pt, GenPart_eta,</div><div class="line">                                  GenPart_phi, GenPart_mass,</div><div class="line">                                  GenPart_pdgId, GenPart_status,</div><div class="line">                                  GenPart_statusFlags, GenPart_genPartIdxMother);</div></div><!-- fragment --><p>Now initialize the tree and some storage objects...</p>
<div class="fragment"><div class="line"><a class="code" href="class_gen_particle_tree.html">GenParticleTree</a> GPT;</div><div class="line"><span class="comment">// prongs are final particles we&#39;ll check</span></div><div class="line">vector&lt;Particle*&gt; tops, Ws, quarks, prongs; </div></div><!-- fragment --><p>Now we can start filling in the tree and tracking particle we care about (top, W, non-top quarks)... </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nGenPart; i++) {</div><div class="line">    GenParticles.SetIndex(i); <span class="comment">// access ith particle</span></div><div class="line">    <a class="code" href="class_particle.html">Particle</a>* this_particle = &amp;GenParticles.particle;</div><div class="line">    GPT.<a class="code" href="class_gen_particle_tree.html#abb1f8139f3e928faf36ad322697fd5af">AddParticle</a>(this_particle); <span class="comment">// add particle to tree</span></div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> this_pdgId = *(this_particle-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (abs(this_pdgId) == 6 &amp;&amp; this_particle-&gt;<a class="code" href="class_particle.html#a217625337b1642ead85a1fb1c0c80660">DeltaR</a>(top_vect) &lt; 0.8) {</div><div class="line">        tops.push_back(this_particle);</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs(this_pdgId) == 24) {</div><div class="line">        Ws.push_back(this_particle);</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs(this_pdgId) &gt;= 1 &amp;&amp; abs(this_pdgId) &lt;= 5) {</div><div class="line">        quarks.push_back(this_particle);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>With the tree built and all of the tops, Ws, and non-top quarks tracked, we'll look for the bottom quark (from the matching top). </p><div class="fragment"><div class="line"><a class="code" href="class_particle.html">Particle</a> *q, *bottom_parent;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> iq = 0; iq &lt; quarks.size(); iq++) {</div><div class="line">    q = quarks[iq];</div><div class="line">    <span class="keywordflow">if</span> (abs(*(q-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>)) == 5) { <span class="comment">// if bottom</span></div><div class="line">        bottom_parent = GPT.<a class="code" href="class_gen_particle_tree.html#a7f812e9b9b5de2498fa03ba6003af7e9">GetParent</a>(q);</div><div class="line">        <span class="keywordflow">if</span> (bottom_parent-&gt;<a class="code" href="class_particle.html#a8b3ab54ed3e81c69863d65e4e6c424a0">flag</a> != <span class="keyword">false</span>) { <span class="comment">// if has parent</span></div><div class="line">            <span class="comment">// if parent is a matched top</span></div><div class="line">            <span class="keywordflow">if</span> (abs(*(bottom_parent-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>)) == 6 &amp;&amp; bottom_parent-&gt;<a class="code" href="class_particle.html#a217625337b1642ead85a1fb1c0c80660">DeltaR</a>(top_vect) &lt; 0.8) { </div><div class="line">                prongs.push_back(q);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Next, look for W (from the matching top) and then get the daughter quarks. </p><div class="fragment"><div class="line"><a class="code" href="class_particle.html">Particle</a> *W, *this_W, *wChild, *wParent;</div><div class="line">vector&lt;Particle*&gt; this_W_children;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> iW = 0; iW &lt; Ws.size(); iW++) {</div><div class="line">    W = Ws[iW];</div><div class="line">    wParent = GPT.<a class="code" href="class_gen_particle_tree.html#a7f812e9b9b5de2498fa03ba6003af7e9">GetParent</a>(W);</div><div class="line">    <span class="keywordflow">if</span> (wParent-&gt;<a class="code" href="class_particle.html#a8b3ab54ed3e81c69863d65e4e6c424a0">flag</a> != <span class="keyword">false</span>) {</div><div class="line">        <span class="comment">// Make sure parent is top that&#39;s in the jet</span></div><div class="line">        <span class="keywordflow">if</span> (abs(*(wParent-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>)) == 6 &amp;&amp; wParent-&gt;<a class="code" href="class_particle.html#a217625337b1642ead85a1fb1c0c80660">DeltaR</a>(top_vect) &lt; 0.8) {</div><div class="line">            this_W = W;</div><div class="line">            this_W_children = GPT.<a class="code" href="class_gen_particle_tree.html#ad4512e01e57691c5498e42064e95227a">GetChildren</a>(this_W);</div><div class="line">            <span class="comment">// Make sure the child is not just another W</span></div><div class="line">            <span class="keywordflow">if</span> (this_W_children.size() == 1 &amp;&amp; this_W_children[0]-&gt;pdgId == W-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>) {</div><div class="line">                this_W = this_W_children[0];</div><div class="line">                this_W_children = GPT.<a class="code" href="class_gen_particle_tree.html#ad4512e01e57691c5498e42064e95227a">GetChildren</a>(this_W);</div><div class="line">            }</div><div class="line">            <span class="comment">// Add children as prongs</span></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ichild = 0; ichild &lt; this_W_children.size(); ichild++) {</div><div class="line">                wChild = this_W_children[ichild];</div><div class="line">                <span class="keywordtype">int</span> child_pdgId = *(wChild-&gt;<a class="code" href="class_particle.html#a3fdb24d523e00a1ce48a6dd2a2c283cd">pdgId</a>);</div><div class="line">                <span class="keywordflow">if</span> (abs(child_pdgId) &gt;= 1 &amp;&amp; abs(child_pdgId) &lt;= 5) {</div><div class="line">                    prongs.push_back(wChild);</div><div class="line">                }</div><div class="line">            } </div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Finally, check how many of the prongs found are within the radius of the jet and return... </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> iprong = 0; iprong &lt; prongs.size(); iprong++) {</div><div class="line">    <span class="keywordflow">if</span> (prongs[iprong]-&gt;<a class="code" href="namespacehardware.html#ad4b8b087606d67425cb9534692e47e0e">DeltaR</a>(top_vect) &lt; 0.8) {</div><div class="line">        nmerged++;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">return</span> nmerged;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
